<% content_for :meta_title, "#{@event.title} is on #{DEFAULT_META["meta_product_name"]}" %>
<% content_for :meta_description, @event.description %>
<% content_for :meta_image, cl_image_path(@event.photo.key) if @event.photo.attached? %>

<div class="fitmate-container-show page-container">
  <div class="link-title">
    <%= link_to events_path do %>
      <div class="fitmate-header-navbar">
        <button class='transparent-button'>
          <i class="fa-solid fa-chevron-left" style="color: #f6d0a5;"></i>
        </button>
      </div>
    <% end %>

    <%# TITLE %>
      <div class="show-title">
        <h1><%= @event.title %></h1>
        <h6><%= @event.localisation.split(" ").last %></h6>
      </div>
  </div>

  <div class="show-header">
    <div class="show-image">
      <%= cl_image_tag @event.photo.key, class:'image-event' %>
    </div>

    <div class="show-distance">
      <% wagon_coordinates = [47.21112643898949, -1.5500990500139393] %>
      <i class="fa-solid fa-map-location-dot icon-map" style="color: #f6d0a5;"></i><%= Geocoder::Calculations.distance_between(wagon_coordinates,[@event.latitude,@event.longitude]).round(2).to_s %> km from your position
    </div>

    <div class="show-duration-level">
      <%= @event.event_level %>
      <%= image_tag("#{@event.event_level}.svg", class: "pictogram-levels") %>
    </div>

    <div class="show-description">
      <%= @event.description %>
    </div>

    <div class="show-organizer">
      <p>Organized by</p>
      <div class="show-organizer-img d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <%= cl_image_tag @organizer.photo.key, class:"organizer-img" %>
          <p class="m-0"><%= @event.organizer.username %></p>
          </div>
          <i class="fa-sharp fa-solid fa-share-nodes fa-2xl" style="color: #f6d0a5;"></i>
        </div>
      </div>

      <div class="show-participant">
        <p><%= @event.event_participants.participe.count %> / <%= @event.max_participant %> potes sont de la partie</p>
        <% @event.event_participants.participe.each do |event_participant| %>
          <div class="show-each-participant">
            <%= cl_image_tag event_participant.user.photo.key, class: 'organizer-img' %>
            <%= event_participant.user.username %>
          </div>
        <% end %>
      </div>

      <div class="btn-message-interested d-flex justify-content-center mt-3">
        <button class= "btn-message">
          <%= link_to "Message", event_chatbox_path(@event) %>
          <%= image_tag('icon-message.svg') %>
        </button>

        <div class="dropdown dropup">
          <button class="btn btn-secondary dropdown-toggle btn-interested" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
            Intéressé?
          </button>
          <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-right dropdown-al" aria-labelledby="dropdownMenuButton2">
            <%# 1 - SI LE PARTICIPANT EST DEJA INSCRIT %>
            <% if EventParticipant.exists?(user_id: current_user, event_id: @event.id, status: "participe") %>

              <li><%= button_to "Inscrit ✔️", "#", class: "btn-du-dropdown" %></li>

              <li>
                <button type="button" class="btn-du-dropdown" data-bs-toggle="modal" data-bs-target="#annuleModal">
                  Annuler?
                </button>
              </li>

            <%# 2 - SI LE PARTICIPANT EST DEJA INTERESSE %>

            <% elsif EventParticipant.exists?(user_id: current_user, event_id: @event.id, status: "intéressé")%>

              <li><%= button_to "Intéressé ✔️", "#", class: "btn-du-dropdown"%></li>

              <li>
                <button type="button" class="btn-du-dropdown" data-bs-toggle="modal" data-bs-target="#annuleModal">
                  Plus intéressé?
                </button>
              </li>

            <%# 3 - SI LE PARTICIPANT N'A PAS ENCORE REAGI %>
            <% else %>
              <li>
                <button type="button" class="btn-du-dropdown" data-bs-toggle="modal" data-bs-target="#participeModal">
                  Je participe!
                </button>

              </li>
                <button type="button" class="btn-du-dropdown" data-bs-toggle="modal" data-bs-target="#interesseModal">
                  Ca m'intéresse
                </button>
              </li>
            <% end %>
          </ul>
          <%= render partial: "shared/participe_modal" %>
          <%= render partial: "shared/annule_modal" %>
          <%= render partial: "shared/interesse_modal" %>
        </div>
      </div>
    </div>
  </div>
</div>
